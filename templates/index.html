<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Downloader</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg1:#0f1020; --bg2:#1a1b33; --neon:#00f7ff; --neon2:#ff00d4; --text:#e8f0ff;
      --muted:#9aa4c7; --error:#ff6b6b; --ok:#8ef6ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto; color:var(--text);
      background: radial-gradient(1200px 900px at 10% 10%, rgba(255,0,212,.08), transparent 60%),
                  radial-gradient(1000px 700px at 90% 20%, rgba(0,247,255,.08), transparent 60%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      display:grid; place-items:center;
    }

    .card{
      width: min(720px, 94vw);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 24px;
      padding: 28px 26px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.06) inset;
      position: relative;
      overflow: hidden;
      animation: pop .5s ease both;
    }
    .card:before{
      content:""; position:absolute; inset:-2px; border-radius:24px; padding:2px;
      background: linear-gradient(135deg, rgba(0,247,255,.35), rgba(255,0,212,.35));
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      pointer-events:none;
    }
    @keyframes pop{from{transform:translateY(10px);opacity:0}to{transform:none;opacity:1}}

    .title{
      display:flex; align-items:center; gap:12px; margin:0 0 18px;
      font-weight:700; font-size:clamp(20px, 3vw, 28px);
    }
    .title .logo{width:38px; height:38px; display:grid; place-items:center; border-radius:12px;
      background: linear-gradient(135deg, var(--neon), var(--neon2)); color:#001018; font-weight:800; box-shadow:0 0 24px rgba(0,247,255,.35);
    }
    .subtitle{margin:0 0 22px; color:var(--muted); font-size:14px}

    form{display:grid; gap:14px;}

    .field{
      display:flex; align-items:center; gap:10px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .field:focus-within{outline: 2px solid rgba(0,247,255,.45);}
    .field input{
      flex:1; background: transparent; border:0; outline:0; color:var(--text);
      font-size:15px; padding:10px 8px;
    }
    .actions{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    }
    .btn{
      appearance:none; border:0; cursor:pointer; border-radius:14px; padding:12px 16px; font-weight:600;
      color:#001018; background: linear-gradient(90deg, var(--neon), var(--neon2));
      box-shadow: 0 8px 24px rgba(0,247,255,.25), 0 0 0 1px rgba(255,255,255,.1) inset;
      transition: transform .12s ease, filter .2s ease, box-shadow .2s ease;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0)}

    .btn.secondary{
      background: rgba(255,255,255,.08); color:var(--text); border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }

    .helper{color:var(--muted); font-size:12px; margin-top:6px}

    .status{margin-top:14px; min-height:24px; font-size:14px}
    .status.ok{color:var(--ok)}
    .status.err{color:var(--error)}

    .grid{display:grid; grid-template-columns: 1fr; gap:12px}
    @media (min-width: 720px){ .grid{grid-template-columns: 2fr 1fr} }

    .preview{
      background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,0.12);
      border-radius:14px; overflow:hidden; min-height:180px; display:grid; place-items:center;
    }
    .preview img{max-width:100%; display:block}
    .preview .placeholder{opacity:.7; font-size:13px; color:var(--muted); padding:18px; text-align:center}

    .toast{position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
      background: rgba(0,0,0,.65); color:#fff; padding:10px 14px; border-radius:10px; font-size:13px;
      box-shadow:0 6px 24px rgba(0,0,0,.35); opacity:0; pointer-events:none; transition:opacity .25s ease;
    }
    .toast.show{opacity:1}

    .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,.25); border-top-color:#fff; border-radius:50%; display:inline-block; animation:spin .8s linear infinite; vertical-align:-3px}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <main class="card">
    <h1 class="title"><span class="logo">YT</span> YouTube Downloader</h1>
    <p class="subtitle">D√°n link YouTube, xem thumbnail preview, b·∫•m <strong>T·∫£i v·ªÅ</strong>. Vibe Gen Z ‚Äì nhanh, g·ªçn, x·ªãn üòé</p>

    <div class="grid">
      <section>
        <form id="ytForm">
          <div class="field">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <input id="urlInput" type="url" inputmode="url" placeholder="D√°n link YouTube ·ªü ƒë√¢y..." autocomplete="off" required />
            <button type="button" id="pasteBtn" class="btn secondary" title="D√°n t·ª´ clipboard">D√°n</button>
          </div>
          <div class="actions">
            <button type="submit" id="downloadBtn" class="btn">üì• T·∫£i v·ªÅ</button>
            <button type="button" id="clearBtn" class="btn secondary">X√≥a</button>
          </div>
          <p class="helper">Tip: H·ªó tr·ª£ c·∫£ d·∫°ng <code>youtube.com/watch?v=...</code> v√† <code>youtu.be/...</code></p>
          <div id="status" class="status" role="status" aria-live="polite"></div>
        </form>
      </section>

      <aside class="preview" id="preview">
        <div class="placeholder">Thumbnail s·∫Ω hi·ªán ·ªü ƒë√¢y sau khi c·∫≠u d√°n link üëá</div>
      </aside>
    </div>
  </main>

  <div id="toast" class="toast">ƒê√£ copy!</div>

  <script>
    const form = document.getElementById('ytForm');
    const urlInput = document.getElementById('urlInput');
    const statusEl = document.getElementById('status');
    const preview = document.getElementById('preview');
    const pasteBtn = document.getElementById('pasteBtn');
    const clearBtn = document.getElementById('clearBtn');
    const toast = document.getElementById('toast');

    // ‚Äî‚Äî‚Äî Utils ‚Äî‚Äî‚Äî
    const YT_REGEX = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([\w-]{11})/i;
    function getVideoId(url){
      try{
        const u = new URL(url);
        if (u.hostname.includes('youtu.be')) return u.pathname.split('/')[1];
        if (u.hostname.includes('youtube.com')) return (u.searchParams.get('v') || '').substring(0,11);
        return '';
      }catch{ return ''; }
    }
    function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1500); }
    function setStatus(msg, type){ statusEl.textContent = msg || ''; statusEl.className = 'status ' + (type||''); }
    function setPreview(url){
      const id = getVideoId(url);
      if(!id){
        preview.innerHTML = '<div class="placeholder">Thumbnail s·∫Ω hi·ªán ·ªü ƒë√¢y sau khi c·∫≠u d√°n link üëá</div>';
        return;
      }
      const img = new Image();
      img.alt = 'Thumbnail';
      img.src = `https://img.youtube.com/vi/${id}/hqdefault.jpg`;
      img.onload = () => {
        preview.innerHTML = '';
        preview.appendChild(img);
      };
      img.onerror = ()=> preview.innerHTML = '<div class="placeholder">Kh√¥ng t·∫£i ƒë∆∞·ª£c thumbnail üò¢</div>';
    }

    // ‚Äî‚Äî‚Äî Paste from clipboard ‚Äî‚Äî‚Äî
    pasteBtn.addEventListener('click', async ()=>{
      try{
        const text = await navigator.clipboard.readText();
        if(text){ urlInput.value = text.trim(); setPreview(urlInput.value); setStatus('ƒê√£ d√°n t·ª´ clipboard ‚úî', 'ok'); }
        else showToast('Clipboard tr·ªëng');
      }catch{ showToast('Tr√¨nh duy·ªát ch·∫∑n ƒë·ªçc clipboard'); }
    });

    // ‚Äî‚Äî‚Äî Clear ‚Äî‚Äî‚Äî
    clearBtn.addEventListener('click', ()=>{ urlInput.value=''; setPreview(''); setStatus('',''); urlInput.focus(); });

    // ‚Äî‚Äî‚Äî Live preview when typing ‚Äî‚Äî‚Äî
    urlInput.addEventListener('input', ()=> setPreview(urlInput.value));

    // ‚Äî‚Äî‚Äî Submit (uses FormData ‚Üí ph√π h·ª£p backend Flask ƒë·ªçc request.form.get('url')) ‚Äî‚Äî‚Äî
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const url = urlInput.value.trim();
      if(!YT_REGEX.test(url)) { setStatus('Link YouTube kh√¥ng h·ª£p l·ªá ‚ùå', 'err'); return; }

      setStatus('ƒêang x·ª≠ l√Ω‚Ä¶ ');

      try{
        const fd = new FormData();
        fd.append('url', url);
        const res = await fetch('/download', { method: 'POST', body: fd });

        if(!res.ok){
          let msg = 'C√≥ l·ªói x·∫£y ra';
          try{ const j = await res.json(); msg = j.error || msg; }catch{}
          setStatus('L·ªói: ' + msg + ' ‚ùå', 'err');
          return;
        }
        const blob = await res.blob();
        // c·ªë g·∫Øng l·∫•y t√™n file t·ª´ header n·∫øu server c√≥ tr·∫£ v·ªÅ
        const cd = res.headers.get('Content-Disposition') || '';
        let filename = 'video.mp4';
        const m = cd.match(/filename\*=UTF-8''([^;\n]+)|filename="?([^";\n]+)"?/i);
        if(m) filename = decodeURIComponent(m[1] || m[2]);

        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a); a.click(); a.remove();
        setStatus('T·∫£i xong r·ªìi n√® ‚ú®', 'ok');
      }catch(err){
        setStatus('L·ªói m·∫°ng: ' + (err?.message||err) + ' ‚ùå', 'err');
      }
    });
  </script>
</body>
</html>
